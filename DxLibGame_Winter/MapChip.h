#pragma once
#include "Vector2.h"
#include <memory>
#include "GameObject.h"

class BoxCollider;
class Camera;
class EnemyController;

/// <summary>
/// マップチップ一個分の画像を担当する
/// MapSystemがこれを固定配列で持つ
/// </summary>
class MapChip : public GameObject
{
private:
	/// <summary>
	/// 自分が今マップのどのチップを担当しているかを記憶
	/// </summary>
	Vector2 m_mapPos;
	/// <summary>
	/// 動きを記憶
	/// </summary>
	Vector2 m_movePos;
	/// <summary>
	/// 画像のハンドル
	/// </summary>
	int m_graphHandle;
	/// <summary>
	/// 当たり判定
	/// </summary>
	std::shared_ptr<BoxCollider> m_collider;
	// カメラさん
	Camera& m_camera;
	// 敵を呼び出す
	EnemyController& m_enemys;

	/// <summary>
	/// 自分が画面外に出ているかをチェックして、
	/// そうならば一周するかのように座標を移動させる
	/// </summary>
	/// <returns>true:画面外判定を通った false:画面内でした</returns>
	bool LoopScreen();
	bool CheckLoopUpAndLeft();
	bool CheckLoopDownAndRight();

	/// <summary>
	/// 現在のマップのデータを参照して、
	/// 自分の持つグラフデータを決める
	/// </summary>
	void ResetMapData();
public:
	MapChip(Camera& camera, EnemyController& cont);

	/// <summary>
	/// 更新処理
	/// 画面外に出たら一周して戻ってきて
	/// 新しい画像を取得する
	/// </summary>
	void Update();

	/// <summary>
	/// これを描画
	/// </summary>
	void Draw() const;

	/// <summary>
	/// MapSystemから指示を受ける
	/// </summary>
	/// <param name="">現在地からどれだけ動かすか</param>
	void Move(Vector2 moveValue) { m_movePos += moveValue; }

	/// <summary>
	/// 座標返す
	/// </summary>
	/// <returns>座標</returns>
	Vector2 GetPos() const { return m_pos; }

	/// <summary>
	/// 返すだけ
	/// なんか受け渡しが面倒になってきたな
	/// </summary>
	/// <returns>マップチップのコライダー</returns>
	BoxCollider& GetCollider() const { return *m_collider; }

	// デバッグ用
	void SetDebugGraph();
};

